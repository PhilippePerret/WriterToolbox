<%
# Édition d'un p-day absolu
raise_unless_admin


site.require 'form_tools'
form.prefix = 'pday'
form.objet  = if param(:pday).nil?
  if site.current_route.objet_id.nil?
    Hash::new
  else
    Unan::Program::AbsPDay::new(site.current_route.objet_id).data
  end
else
  param(:pday)
end

lien_read_pday = "Afficher".in_a(href:"abs_pday/#{form.objet[:id]}", id:'lien_read_pday')
%>
<script type="text/javascript">
function set_href_lien_read(o){
  $('a#lien_read_pday').attr('href', "abs_pday/"+o.value+"/read?in=unan");
}
</script>

<%
# ---------------------------------------------------------------------
#   Barre de boutons généraux
#   Par exemple pour éditer le jour programme suivant ou précédent
# ---------------------------------------------------------------------
%>
<div class="pdays_tools right">
 [jour précédent] [---] [jour suivant]
</div>


<%
# ---------------------------------------------------------------------
#   Le formulaire proprement dit
# ---------------------------------------------------------------------
%>
<form class="dim2080" action="abs_pday/edit?in=unan_admin" method="POST">

  <%= "save_absolute_pday".in_hidden(name:'operation') %>

  <%= form.field_text('JOUR', 'id', nil, {class:'short', onchange:"set_href_lien_read(this)"}) %>
  <%= form.field_description("Le JOUR est un nombre de 1 à 365 correspondant au jour dans l'année de ce P-Day de façon absolue, i.e. sans tenir compte du rythme (donc à rytme moyen avec 1 p-day = 1 jour réel).") %>

  <%= form.field_text('Titre', 'titre', nil) %>
  <%= form.field_description("Titre général pouvant caractériser ce jour de travail du programme. Il doit témoigner du travail principal de cette journée.") %>

  <%= form.field_textarea("Description", 'description', "") %>
  <%= form.field_description("Description générale du jour-programme.") %>

  <%= form.field_text("Works", 'works', nil) %>
  <%= form.field_description("Liste des travaux à accomplir, par ID et dans l'ordre où ils doivent être effectués, séparés par des simples espaces.") %>
  <%= form.field_raw("", "", nil, {field:"[LIEN POUR CRÉER UN NOUVEAU TRAVAIL]".in_a(href:"abs_work/edit?in=unan_admin", target:'_new_work_')}) %>

  <%= form.field_text("Minimum Points", 'minimum_points', nil, {class:'short'}) %>
  <%= form.field_description("Nombre de points minimum qu'il faut acquérir pour considérer que le jour-programme est accompli. Ce nombre sera calculé par rapport au nombre de points de chaque travail en cas de non définition explicite ici.") %>

  <%= form.submit_button "Enregistrer" %>
</form>
<%
# ---------------------------------------------------------------------
#   Aide
# ---------------------------------------------------------------------
%>
<p>
  Noter qu'un travail lancé par un jour-programme peut s'étaler sur plusieurs jours (il le fait même en règle générale). La définition de ce jour-programme doit en tenir compte et ne pas répéter un travail déjà en route.
</p>
<p>
  Donc, dans le formulaire ci-dessus, il convient de ne définir que les travaux qui sont démarrés le jour concerné par le formulaire.
</p>

<h3>Aperçu des travaux</h3>
<p>
  Pour avoir un aperçu du plan général des travaux, i.e. un aperçu qui tient compte du nombre de jours de chaque travail, on peut utiliser le lien ci-dessous :
</p>
<p>
  <%= "Plan des travaux".in_a(href: "abs_work/map?in=unan_admin", target:'_new') %>
</p>
