<%
# Vue principale pour le tableau de bord d'administration
raise_unless_admin
%>
<%= Admin::titre_h1 %>
<p class='small italic discret'>Bienvenue dans le tableau de bord de l'administration du site.</p>

<div id="admin_tools">
  <%= "Console".in_a(href:'admin/console').in_div(class:'admin_tool') %>
  <%=
    (
      "Scénodico (édition)".in_a(href:'scenodico/edit') +
      "Synchronisation…".in_a(href:"scenodico/synchro")
    ).in_div(class:'admin_tool') %>
  <%=
    (
      "Filmodico (édition)".in_a(href:'filmodico/edit') +
      "Synchronisation…".in_a(href:"filmodico/synchro")
    ).in_div(class:'admin_tool') %>
  <%= "Narration (page)".in_a(href:'page/edit?in=cnarration').in_div(class:'admin_tool') %>
  <%=
    (
      "Forum".in_a(href:'forum/dashboard') +
      "Synchronisation…".in_a(href:'forum/synchro')
    ).in_div(class:'admin_tool')
   %>
   <%=
    (
      "Analyses".in_a(href:'admin/dashboard?in=analyse')
    ).in_div(class:'admin_tool')
   %>
</div><%# div#admin_tools %>

<%
# ---------------------------------------------------------------------
#
# Partie propre à chaque administrateur s'il possède un fichier dans
# le dossier ./objet/admin/admins/<user-id>-<pseudo>
#
%>
<% if user.has_own_dashboard? %>
  <%= user.dashboard_path.deserb %>
<% end %>

<%
# Si c'est un grand manitou, on affiche tous les bureaux propres
if user.manitou?
%>

  <div class='right'>
    <%= "Afficher autres bureaux".in_a(onclick:"$('div#autres_bureaux').toggle()") %>
  </div>
  <div id="autres_bureaux" style="display:none">
    <% Dir["#{Admin::Dashboard::folder_admins}/*.erb"].each do |p| %>
      <%
        # On passe le bureau de l'user courant s'il a un bureau
        # propre
        uid = File.basename(p).split('-')[0].to_i
        next if user.id == uid
      %>
      <%= Vue::new(p.sub(/^\.\/objet\//,'')).output %>
    <% end %>
  </div>
<% end %>
