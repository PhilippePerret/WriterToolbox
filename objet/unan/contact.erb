<%
# Formulaire de contact de phil sur le programme UN AN

enable_comments
%>
<%= Unan::titre_h1("Contact") %>

<%
if param(:operation) && Unan.respond_to?(param(:operation).to_sym)
  Unan.send(param(:operation).to_sym)
end
%>

<% if Unan::current_mail.sent? %>
  <p class='big'>
    Votre message a été transmis avec succès à Phil.
  </p>
  <p class='small'>
    Vous pouvez refermer cette fenêtre.
  </p>
<% else %>
<%
site.require 'form_tools'
form.prefix = 'contact'
%>
<form id="form_contact" class="dim2080" action="unan/contact" method="POST">
  <%= "envoyer".in_hidden(name:'operation') %>
  <%= form.field_text("Sujet", 'sujet', Unan::current_mail.subject) %>
  <%= form.field_textarea("Message", 'message', Unan::current_mail.message) %>
  <% if user.identified? %>
    <%= user.mail.in_hidden(name:'contact[mail]') %>
    <%= user.mail.in_hidden(name:'contact[mail_confirmation]') %>
  <% else %>
    <%= form.field_text("Votre mail", 'mail', Unan::current_mail.sender) %>
    <%= form.field_text("Confirmation", 'mail_confirmation', Unan::current_mail.mail_confirmation) %>
  <% end %>
  <%= form.field_text("Anti-robot", 'captcha', "", {
    class:'short', text_before: "Nombre de jours dans une année bisextile : "
    }) %>
  <%= form.submit_button("Envoyer") %>
</form>
<% end %>
