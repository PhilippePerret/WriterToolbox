<%
# Vue pour le paiement de l'inscription au programme UN AN UN SCRIPT
#
# NOTE : C'est le module `paiement.rb` au même niveau que ce fichier
# qui appelle la méthode `make_transaction` qui permet de procéder
# au paiement du programme.
%>
<%= Unan::titre_h1 %>


<%

# Si l'utilisateur est INSCRIT AU PROGRAMME 1 AN 1 SCRIPT
if user.unanunscript?

  # Si l'utilisateur vient juste de souscrire au programme
  # UN AN UN SCRIPT, on lui fait un accueil chaleureux
  # NOTE C'est celui qui est est contenu dans on_ok.erb, qu'on
  # peut obtenir par site.paiement.output
  if user.just_subscribe_unanunscript?

    %><%= site.paiement.output %><%

  else
    # Si l'user en vient pas juste de s'inscrire au programme, mais
    # est inscrit depuis un bon bout de temps
    %>
    <p>Vous êtes déjà inscrit<%= f_e %> à ce programme, vous ne devriez pas avoir à repasser par ici ;-)…</p>

  <% end

# Si l'user N'EST PAS ENCORE INSCRIT au programme 1 an 1 script
else
  %>
  <h2>Inscription</h2>
  <%
  # Si l'user est ABONNÉ au site
  if user.subscribed?

    # On va vérifier le message et le coût de son inscription au
    # programme UN AN UN SCRIT, en sachant que s'il a payé il y a
    # moins de 6 mois, son abonnement au site est déduit de son
    # inscription au programme.

    %><%= user.check_abonnement %>
    <%= site.paiement.output %><%

  # Si l'user est seulement INSCRIT AU SITE
  elsif user.identified?

    %><p class='small'>Vous êtes enregistré<%= f_e %> sur le site, mais vous n'avez pas d'abonnement courant. En conséquence, notez que l'inscription au programme “Un An Un Script” offre automatiquement <strong>deux ans d'abonnement</strong> au site pour une utilisation complète de <a href="tool/list" target="_new">tous les outils</a>.</p>
    <%= site.paiement.output %><%

  # Si l'user n'est NI INSCRIT, NI ABONNÉ
  else

      # Dans le cas où l'user n'est pas encore inscrit sur le site,
      # c'est une inscription complète, avec paiement de l'inscription
      # entière au programme.
      # On doit donc trouver le formulaire d'inscription et le bouton de
      # paiement paypal, ou alors le formulaire d'inscription qui renverra
      # vers le paiment paypal en fin de processus. Donc un renvoi ici par
      # la route "user/paiement?in=unan"
    %>
    <p class='small'>L'inscription au programme “Un An Un Script” vous abonne aussi pendant deux ans au site et vous offre donc un accès complet à tous les autres outils. Merci de bien vouloir remplir le formulaire ci-dessous.</p>
    <%=
      app.require_optional '_per_route/user/signup'
      page.view('user/signup')

  end
  %>
<%
end
%>
